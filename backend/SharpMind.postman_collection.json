{
  "info": {
    "name": "Sharp Mind AI Rep API",
    "description": "Postman collection for Sharp Mind AI Rep endpoints.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "if (!pm.collectionVariables.get('owner_email')) {",
          "  pm.collectionVariables.set('owner_email', `owner+${Date.now()}@example.com`);",
          "}",
          "if (!pm.collectionVariables.get('owner_password')) {",
          "  pm.collectionVariables.set('owner_password', 'ChangeMe123!');",
          "}",
          "if (!pm.collectionVariables.get('business_phone')) {",
          "  pm.collectionVariables.set('business_phone', '+14698879267');",
          "}"
        ]
      }
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://127.0.0.1:8000" },
    { "key": "wsBaseUrl", "value": "ws://127.0.0.1:8000" },
    { "key": "access_token", "value": "" },
    { "key": "owner_email", "value": "" },
    { "key": "owner_password", "value": "" },
    { "key": "business_phone", "value": "+14698879267" },
    { "key": "pet_business_name", "value": "Sharp Mind Pets (Cats & Dogs)" },
    { "key": "staff_password", "value": "ChangeMe123!" },
    { "key": "staff_user_email_1", "value": "staff-cats@example.com" },
    { "key": "staff_user_email_2", "value": "staff-dogs@example.com" },
    { "key": "business_id", "value": "" },
    { "key": "call_id", "value": "" },
    { "key": "profile_id", "value": "" },
    { "key": "rule_id", "value": "" },
    { "key": "caller_number", "value": "+15555550123" }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.access_token) {",
                  "    pm.collectionVariables.set('access_token', json.access_token);",
                  "  }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{owner_email}}\",\n  \"password\": \"{{owner_password}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "auth", "login"]
            }
          }
        },
        {
          "name": "Register",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.access_token) {",
                  "    pm.collectionVariables.set('access_token', json.access_token);",
                  "  }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{owner_email}}\",\n  \"password\": \"{{owner_password}}\",\n  \"role\": \"owner\",\n  \"business_id\": null,\n  \"phone\": \"{{business_phone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "auth", "register"]
            }
          }
        }
      ]
    },
    {
      "name": "Businesses",
      "item": [
        {
          "name": "Create Business",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) {",
                  "    pm.collectionVariables.set('business_id', json.id);",
                  "  }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{pet_business_name}}\",\n  \"phone_number\": \"{{business_phone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses"]
            }
          }
        },
        {
          "name": "Get Business",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}"]
            }
          }
        },
        {
          "name": "Upload Knowledge",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"category\": \"faq\",\n  \"content\": \"Store hours are 9am to 6pm.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/knowledge",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "knowledge"]
            }
          }
        }
      ]
    },
    {
      "name": "Escalation Rules",
      "item": [
        {
          "name": "Create Rule",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) {",
                  "    pm.collectionVariables.set('rule_id', json.id);",
                  "  }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"keywords\": [\"refund\", \"manager\"],\n  \"priority\": 1,\n  \"action\": \"notify_owner\",\n  \"notify_user_ids\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/escalation-rules",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "escalation-rules"]
            }
          }
        },
        {
          "name": "List Rules",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/escalation-rules",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "escalation-rules"]
            }
          }
        },
        {
          "name": "Update Rule",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"keywords\": [\"refund\", \"chargeback\"],\n  \"priority\": 2,\n  \"action\": \"notify_staff\",\n  \"notify_user_ids\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/escalation-rules/{{rule_id}}",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "v1",
                "businesses",
                "{{business_id}}",
                "escalation-rules",
                "{{rule_id}}"
              ]
            }
          }
        },
        {
          "name": "Delete Rule",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "DELETE",
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/escalation-rules/{{rule_id}}",
              "host": ["{{baseUrl}}"],
              "path": [
                "api",
                "v1",
                "businesses",
                "{{business_id}}",
                "escalation-rules",
                "{{rule_id}}"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Calls",
      "item": [
        {
          "name": "List Calls",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/calls?business_id={{business_id}}&limit=20&offset=0",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "calls"],
              "query": [
                { "key": "business_id", "value": "{{business_id}}" },
                { "key": "limit", "value": "20" },
                { "key": "offset", "value": "0" }
              ]
            }
          }
        },
        {
          "name": "Get Call",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/calls/{{call_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "calls", "{{call_id}}"]
            }
          }
        },
        {
          "name": "Get Call Audio",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/calls/{{call_id}}/audio",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "calls", "{{call_id}}", "audio"]
            }
          }
        },
        {
          "name": "Add Call Message",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sender\": \"customer\",\n  \"content\": \"Can I get a refund?\",\n  \"sentiment\": 0.1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/calls/{{call_id}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "calls", "{{call_id}}", "messages"]
            }
          }
        },
        {
          "name": "Inbound Call Webhook",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"call_control_id\": \"test-control-id\",\n  \"caller_number\": \"+15555550123\",\n  \"to_number\": \"+15555550100\",\n  \"business_id\": \"{{business_id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/calls/inbound",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "calls", "inbound"]
            }
          }
        }
      ]
    },
    {
      "name": "Customers",
      "item": [
        {
          "name": "Get Customer Profile",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/customers/{{caller_number}}?business_id={{business_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "customers", "{{caller_number}}"],
              "query": [{ "key": "business_id", "value": "{{business_id}}" }]
            }
          }
        },
        {
          "name": "Update Customer Profile",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Alex Caller\",\n  \"preferences\": {\"language\": \"en\"},\n  \"history\": {\"last_issue\": \"billing\"}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/customers/{{profile_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "customers", "{{profile_id}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Analytics",
      "item": [
        {
          "name": "Summary",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/analytics/summary?business_id={{business_id}}&period=30d",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "analytics", "summary"],
              "query": [
                { "key": "business_id", "value": "{{business_id}}" },
                { "key": "period", "value": "30d" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Webhooks",
      "item": [
        {
          "name": "Action Point",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"type\": \"notify\",\n  \"details\": {\"message\": \"Follow up with customer\"}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/webhooks/actions",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "webhooks", "actions"]
            }
          }
        }
      ]
    },
    {
      "name": "Media",
      "item": [
        {
          "name": "Telnyx Media WebSocket",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{wsBaseUrl}}/api/v1/media/telnyx?call_id={{call_id}}",
              "host": ["{{wsBaseUrl}}"],
              "path": ["api", "v1", "media", "telnyx"],
              "query": [{ "key": "call_id", "value": "{{call_id}}" }]
            }
          }
        }
      ]
    },
    {
      "name": "Supabase",
      "item": [
        {
          "name": "List Instruments (HTML)",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/supabase",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "supabase"]
            }
          }
        }
      ]
    },
    {
      "name": "Seed - Pets Business",
      "item": [
        {
          "name": "Create Pets Business",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) {",
                  "    pm.collectionVariables.set('business_id', json.id);",
                  "  }",
                  "} else if (pm.response.code === 400) {",
                  "  const baseUrl = pm.collectionVariables.get('baseUrl');",
                  "  const phone = pm.collectionVariables.get('business_phone');",
                  "  pm.sendRequest({",
                  "    url: `${baseUrl}/api/v1/businesses/lookup/by-phone?phone_number=${encodeURIComponent(phone)}`,",
                  "    method: 'GET',",
                  "    header: { Authorization: `Bearer ${pm.collectionVariables.get('access_token')}` }",
                  "  }, (err, res) => {",
                  "    if (!err && res && res.code === 200) {",
                  "      const data = res.json();",
                  "      if (data.id) {",
                  "        pm.collectionVariables.set('business_id', data.id);",
                  "      }",
                  "    }",
                  "  });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{pet_business_name}}\",\n  \"phone_number\": \"{{business_phone}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses"]
            }
          }
        },
        {
          "name": "Lookup Business by Phone",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  const json = pm.response.json();",
                  "  if (json.id) {",
                  "    pm.collectionVariables.set('business_id', json.id);",
                  "  }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/lookup/by-phone?phone_number={{business_phone}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "lookup", "by-phone"],
              "query": [{ "key": "phone_number", "value": "{{business_phone}}" }]
            }
          }
        },
        {
          "name": "Upload Knowledge - Cats",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"category\": \"Cats\",\n  \"content\": \"Cats: vaccination schedule, common illnesses (URI, dental), grooming guidance, and boarding policy. Emergency signs: refusal to eat >24h, labored breathing, persistent vomiting.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/knowledge",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "knowledge"]
            }
          }
        },
        {
          "name": "Upload Knowledge - Dogs",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"category\": \"Dogs\",\n  \"content\": \"Dogs: core vaccines (DHPP, Rabies), parasite prevention, grooming schedule, and boarding requirements. Emergency signs: bloat, collapse, seizures.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/knowledge",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "knowledge"]
            }
          }
        },
        {
          "name": "Create Escalation Rule - Aggression",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"keywords\": [\"bite\", \"aggressive\", \"attack\", \"injury\"],\n  \"priority\": 2,\n  \"action\": \"notify_owner\",\n  \"notify_user_ids\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/escalation-rules",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "escalation-rules"]
            }
          }
        },
        {
          "name": "Create Escalation Rule - Billing",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"keywords\": [\"refund\", \"charge\", \"invoice\", \"billing\"],\n  \"priority\": 1,\n  \"action\": \"notify_staff\",\n  \"notify_user_ids\": []\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/businesses/{{business_id}}/escalation-rules",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "businesses", "{{business_id}}", "escalation-rules"]
            }
          }
        },
        {
          "name": "Create Staff User - Cats",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{staff_user_email_1}}\",\n  \"password\": \"{{staff_password}}\",\n  \"role\": \"staff\",\n  \"phone\": \"+14698870001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users"]
            }
          }
        },
        {
          "name": "Create Staff User - Dogs",
          "request": {
            "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{access_token}}" }] },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{staff_user_email_2}}\",\n  \"password\": \"{{staff_password}}\",\n  \"role\": \"staff\",\n  \"phone\": \"+14698870002\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users"]
            }
          }
        }
      ]
    }
  ]
}
